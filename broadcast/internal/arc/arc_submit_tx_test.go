package arc

import (
	"bytes"
	"context"
	"errors"
	"fmt"
	"github.com/rs/zerolog"
	"io"
	"net/http"
	"testing"

	"github.com/libsv/go-bc"
	"github.com/stretchr/testify/assert"

	"github.com/bitcoin-sv/go-broadcast-client/broadcast"
	"github.com/bitcoin-sv/go-broadcast-client/broadcast/broadcast-client-mock/fixtures"
	"github.com/bitcoin-sv/go-broadcast-client/httpclient"
)

func TestSubmitTransaction(t *testing.T) {
	testCases := []struct {
		name           string
		transaction    *broadcast.Transaction
		httpResponse   *http.Response
		httpError      error
		expectedResult *broadcast.SubmitTxResponse
		expectedError  error
	}{
		{
			name: "successful request",
			transaction: &broadcast.Transaction{
				Hex: "abc123",
			},
			httpResponse: &http.Response{
				StatusCode: http.StatusOK,
				Body: io.NopCloser(bytes.NewBufferString(`
                    {
                        "txStatus": "CONFIRMED"
                    }
                    `)),
			},
			expectedResult: &broadcast.SubmitTxResponse{
				BaseResponse: broadcast.BaseResponse{Miner: "http://example.com"},
				SubmittedTx: &broadcast.SubmittedTx{
					BaseSubmitTxResponse: broadcast.BaseSubmitTxResponse{
						BaseTxResponse: broadcast.BaseTxResponse{
							TxStatus: broadcast.Confirmed,
						},
					},
				},
			},
		},
		{
			name: "error in HTTP request",
			transaction: &broadcast.Transaction{
				Hex: "abc123",
			},
			httpError:     errors.New("some error"),
			expectedError: errors.New("some error"),
		},
		{
			name: "missing txStatus in response",
			transaction: &broadcast.Transaction{
				Hex: "abc123",
			},
			httpResponse: &http.Response{
				StatusCode: http.StatusOK,
				Body: io.NopCloser(bytes.NewBufferString(`
                    {
                        "dummyField": "dummyValue"
                    }
                    `)),
			},
			expectedError: broadcast.ErrMissingStatus,
		},
	}
	for _, tc := range testCases {
		t.Run(tc.name, func(t *testing.T) {
			// given
			mockHttpClient := new(MockHttpClient)
			testLogger := zerolog.Nop()

			client := &ArcClient{
				HTTPClient: mockHttpClient,
				apiURL:     "http://example.com",
				token:      "someToken",
				Logger:     &testLogger,
			}

			body, _ := createSubmitTxBody(client, tc.transaction, broadcast.EfFormat)
			expectedPayload := httpclient.NewPayload(
				httpclient.POST,
				"http://example.com"+arcSubmitTxRoute,
				"someToken",
				body,
			)
			appendSubmitTxHeaders(&expectedPayload, nil)

			mockHttpClient.On("DoRequest", context.Background(), expectedPayload).
				Return(tc.httpResponse, tc.httpError).Once()

			// when
			result, err := client.SubmitTransaction(context.Background(), tc.transaction)

			// then
			assert.Equal(t, tc.expectedResult, result)
			assert.Equal(t, tc.expectedError, err)

			// assert Expectations on the mock
			mockHttpClient.AssertExpectations(t)
		})
	}
}

func TestConvertTransaction(t *testing.T) {
	testCases := []struct {
		name           string
		transaction    *broadcast.Transaction
		httpResponse   *http.Response
		httpError      error
		expectedResult *SubmitTxRequest
	}{
		{
			name: "successful conversion from RawTx to EF",
			transaction: &broadcast.Transaction{
				Hex: "0100000001d6d1607b208b30c0a3fe21d563569c4d2a0f913604b4c5054fe267da6be324ab220000006b4830450221009a965dcd5d42983090a63cfd761038ff8adcea621c46a68a205f326292a95383022061b8d858f366c69f3ebd30a60ccafe36faca4e242ac3d2edd3bf63b669bcf23b4121034e871e147aa4a3e2f1665eaf76cf9264d089b6a91702af92bd6ce33bac84a765ffffffff0123020000000000001976a914d8819a7197d3e221e15f4348203fdecfd29fa2b888ac00000000",
			},
			httpResponse: &http.Response{
				StatusCode: http.StatusOK,
				Body: io.NopCloser(bytes.NewBufferString(`
                    {
						"transaction": "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"
                    }
                    `)),
			},
			expectedResult: &SubmitTxRequest{
				RawTx: "010000000000000000ef01d6d1607b208b30c0a3fe21d563569c4d2a0f913604b4c5054fe267da6be324ab220000006b4830450221009a965dcd5d42983090a63cfd761038ff8adcea621c46a68a205f326292a95383022061b8d858f366c69f3ebd30a60ccafe36faca4e242ac3d2edd3bf63b669bcf23b4121034e871e147aa4a3e2f1665eaf76cf9264d089b6a91702af92bd6ce33bac84a765ffffffffbc020000000000001976a914a5127a45f084089fc1ff33012c3da3dfbc0fc7db88ac0123020000000000001976a914d8819a7197d3e221e15f4348203fdecfd29fa2b888ac00000000",
			},
		},
	}
	for _, tc := range testCases {
		t.Run(tc.name, func(t *testing.T) {
			// given
			mockHttpClient := new(MockHttpClient)
			expectedPayload := httpclient.NewPayload(
				httpclient.GET,
				"https://junglebus.gorillapool.io/v1/transaction/get/ab24e36bda67e24f05c5b40436910f2a4d9c5663d521fea3c0308b207b60d1d6",
				"",
				nil,
			)

			mockHttpClient.On("DoRequest", context.Background(), expectedPayload).
				Return(tc.httpResponse, tc.httpError).Once()

			client := &ArcClient{
				HTTPClient: mockHttpClient,
				apiURL:     "http://example.com",
				token:      "someToken",
			}

			// when
			result, err := formatTxRequest(client, tc.transaction, broadcast.RawTxFormat)

			// then
			assert.NoError(t, err)
			assert.Equal(t, tc.expectedResult, result)
		})
	}
}

func TestConvertBatchTransactions(t *testing.T) {
	testCases := []struct {
		name            string
		transactions    []*broadcast.Transaction
		httpResponses   []*http.Response
		httpError       error
		expectedResults []*SubmitTxRequest
	}{
		{
			name: "successful batch conversion from RawTx to EF",
			transactions: []*broadcast.Transaction{
				{
					Hex: "0100000001d6d1607b208b30c0a3fe21d563569c4d2a0f913604b4c5054fe267da6be324ab220000006b4830450221009a965dcd5d42983090a63cfd761038ff8adcea621c46a68a205f326292a95383022061b8d858f366c69f3ebd30a60ccafe36faca4e242ac3d2edd3bf63b669bcf23b4121034e871e147aa4a3e2f1665eaf76cf9264d089b6a91702af92bd6ce33bac84a765ffffffff0123020000000000001976a914d8819a7197d3e221e15f4348203fdecfd29fa2b888ac00000000",
				},
				{
					Hex: "0100000001d6d1607b208b30c0a3fe21d563569c4d2a0f913604b4c5054fe267da6be324ab220000006b4830450221009a965dcd5d42983090a63cfd761038ff8adcea621c46a68a205f326292a95383022061b8d858f366c69f3ebd30a60ccafe36faca4e242ac3d2edd3bf63b669bcf23b4121034e871e147aa4a3e2f1665eaf76cf9264d089b6a91702af92bd6ce33bac84a765ffffffff0123020000000000001976a914d8819a7197d3e221e15f4348203fdecfd29fa2b888ac00000000",
				},
			},
			httpResponses: []*http.Response{
				{
					StatusCode: http.StatusOK,
					Body: io.NopCloser(bytes.NewBufferString(`
                    {
						"transaction": "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"
                    }
                    `)),
				},
				{
					StatusCode: http.StatusOK,
					Body: io.NopCloser(bytes.NewBufferString(`
                    {
						"transaction": "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"
                    }
                    `)),
				},
			},
			expectedResults: []*SubmitTxRequest{
				{
					RawTx: "010000000000000000ef01d6d1607b208b30c0a3fe21d563569c4d2a0f913604b4c5054fe267da6be324ab220000006b4830450221009a965dcd5d42983090a63cfd761038ff8adcea621c46a68a205f326292a95383022061b8d858f366c69f3ebd30a60ccafe36faca4e242ac3d2edd3bf63b669bcf23b4121034e871e147aa4a3e2f1665eaf76cf9264d089b6a91702af92bd6ce33bac84a765ffffffffbc020000000000001976a914a5127a45f084089fc1ff33012c3da3dfbc0fc7db88ac0123020000000000001976a914d8819a7197d3e221e15f4348203fdecfd29fa2b888ac00000000",
				},
				{
					RawTx: "010000000000000000ef01d6d1607b208b30c0a3fe21d563569c4d2a0f913604b4c5054fe267da6be324ab220000006b4830450221009a965dcd5d42983090a63cfd761038ff8adcea621c46a68a205f326292a95383022061b8d858f366c69f3ebd30a60ccafe36faca4e242ac3d2edd3bf63b669bcf23b4121034e871e147aa4a3e2f1665eaf76cf9264d089b6a91702af92bd6ce33bac84a765ffffffffbc020000000000001976a914a5127a45f084089fc1ff33012c3da3dfbc0fc7db88ac0123020000000000001976a914d8819a7197d3e221e15f4348203fdecfd29fa2b888ac00000000",
				},
			},
		},
	}
	for _, tc := range testCases {
		t.Run(tc.name, func(t *testing.T) {
			// given
			mockHttpClient := new(MockHttpClient)
			expectedPayload := httpclient.NewPayload(
				httpclient.GET,
				"https://junglebus.gorillapool.io/v1/transaction/get/ab24e36bda67e24f05c5b40436910f2a4d9c5663d521fea3c0308b207b60d1d6",
				"",
				nil,
			)

			for _, resp := range tc.httpResponses {
				mockHttpClient.On("DoRequest", context.Background(), expectedPayload).
					Return(resp, tc.httpError).Once()
			}

			client := &ArcClient{
				HTTPClient: mockHttpClient,
				apiURL:     "http://example.com",
				token:      "someToken",
			}

			// when
			results := make([]*SubmitTxRequest, 0, len(tc.transactions))
			errors := make([]error, 0)
			for _, tx := range tc.transactions {
				requestTx, err := formatTxRequest(client, tx, broadcast.RawTxFormat)
				if err != nil {
					errors = append(errors, err)
				}
				results = append(results, requestTx)
			}

			// then
			assert.Empty(t, errors)
			assert.Equal(t, tc.expectedResults, results)
		})
	}
}

func TestDecodeSubmitResponseBody(t *testing.T) {
	mp, _ := bc.NewMerklePathFromStr(fixtures.TxMerklePath)
	testCases := []struct {
		name           string
		httpResponse   *http.Response
		expectedResult *broadcast.SubmittedTx
	}{
		{
			name: "successful decode",
			httpResponse: &http.Response{
				StatusCode: http.StatusOK,
				Body:       io.NopCloser(bytes.NewBufferString(fmt.Sprintf("{\"merklePath\":\"%s\"}", fixtures.TxMerklePath))),
			},
			expectedResult: &broadcast.SubmittedTx{
				BaseSubmitTxResponse: broadcast.BaseSubmitTxResponse{
					BaseTxResponse: broadcast.BaseTxResponse{
						MerklePath: fixtures.TxMerklePath,
					},
				},
				MerklePath: mp,
			},
		},
		{
			name: "empty merkle path",
			httpResponse: &http.Response{
				StatusCode: http.StatusOK,
				Body: io.NopCloser(bytes.NewBufferString(`
					{
						"merklePath": ""
					}
					`)),
			},
			expectedResult: &broadcast.SubmittedTx{
				MerklePath: nil,
			},
		},
	}
	for _, tc := range testCases {
		t.Run(tc.name, func(t *testing.T) {
			// when
			model, err := decodeSubmitResponseBody(tc.httpResponse)

			// then
			assert.NoError(t, err)
			assert.Equal(t, tc.expectedResult, model)
		})
	}
}

func TestSubmitBatchTransactions(t *testing.T) {
	testCases := []struct {
		name           string
		transactions   []*broadcast.Transaction
		httpResponse   *http.Response
		httpError      error
		expectedResult *broadcast.SubmitBatchTxResponse
		expectedError  error
	}{
		{
			name: "successful request",
			transactions: []*broadcast.Transaction{
				{Hex: "abc123"},
				{Hex: "cba321"},
			},
			httpResponse: &http.Response{
				StatusCode: http.StatusOK,
				Body: io.NopCloser(bytes.NewBufferString(`
					[
						{
							"txStatus": "CONFIRMED"
						},
						{
							"txStatus": "CONFIRMED"
						}
					]`)),
			},
			expectedResult: &broadcast.SubmitBatchTxResponse{
				BaseResponse: broadcast.BaseResponse{Miner: "http://example.com"},
				Transactions: []*broadcast.SubmittedTx{
					{
						BaseSubmitTxResponse: broadcast.BaseSubmitTxResponse{
							BaseTxResponse: broadcast.BaseTxResponse{
								TxStatus: broadcast.Confirmed,
							},
						},
					},
					{
						BaseSubmitTxResponse: broadcast.BaseSubmitTxResponse{
							BaseTxResponse: broadcast.BaseTxResponse{
								TxStatus: broadcast.Confirmed,
							},
						},
					},
				},
			},
		},
		{
			name: "error in HTTP request",
			transactions: []*broadcast.Transaction{
				{Hex: "abc123"},
				{Hex: "cba321"},
			},
			httpError:     errors.New("some error"),
			expectedError: errors.New("some error"),
		},
		{
			name: "missing txStatus in response",
			transactions: []*broadcast.Transaction{
				{Hex: "abc123"},
				{Hex: "cba321"},
			},
			httpResponse: &http.Response{
				StatusCode: http.StatusOK,
				Body: io.NopCloser(bytes.NewBufferString(`
					[
						{
							"dummyField": "dummyValue"
						},
						{
							"txStatus": "CONFIRMED"
						}
					]`)),
			},
			expectedError: broadcast.ErrMissingStatus,
		},
	}
	for _, tc := range testCases {
		t.Run(tc.name, func(t *testing.T) {
			// given
			mockHttpClient := new(MockHttpClient)
			testLogger := zerolog.Nop()

			client := &ArcClient{
				HTTPClient: mockHttpClient,
				apiURL:     "http://example.com",
				token:      "someToken",
				Logger:     &testLogger,
			}

			body, _ := createSubmitBatchTxsBody(client, tc.transactions, broadcast.EfFormat)
			expectedPayload := httpclient.NewPayload(
				httpclient.POST,
				"http://example.com"+arcSubmitBatchTxsRoute,
				"someToken",
				body,
			)
			appendSubmitTxHeaders(&expectedPayload, nil)

			mockHttpClient.On("DoRequest", context.Background(), expectedPayload).
				Return(tc.httpResponse, tc.httpError).Once()

			// when
			result, err := client.SubmitBatchTransactions(context.Background(), tc.transactions)

			// then
			assert.Equal(t, tc.expectedResult, result)
			assert.Equal(t, tc.expectedError, err)

			// assert Expectations on the mock
			mockHttpClient.AssertExpectations(t)
		})
	}
}
